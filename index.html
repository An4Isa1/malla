<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Pensum Economía - UMNG</title>
  <style>
    body {
      font-family: 'Times New Roman', serif;
      margin: 0;
      padding: 0 1rem;
    }
    h1 {
      font-family: Georgia, serif;
      font-style: italic;
      text-align: center;
      margin-top: 1rem;
    }
    .semestre {
      margin: 1rem 0;
      padding: 1rem;
      border-radius: 1rem;
      box-shadow: 0 0 5px rgba(0,0,0,0.2);
    }
    .materia {
      margin: 0.5rem 0;
      padding: 0.5rem;
      cursor: pointer;
      background: #f2f2f2;
      border-radius: 0.5rem;
    }
    .materia.bloqueada {
      background: #ccc;
      pointer-events: none;
      opacity: 0.5;
    }
    .materia.aprobada {
      text-decoration: line-through;
      background: #c0f5c0;
    }
    .campos-extra {
      margin-top: 0.5rem;
      padding: 0.5rem;
      background: #e8e8e8;
      border-radius: 0.5rem;
    }
    .intento {
      margin-bottom: 1rem;
    }
    .definitiva {
      font-weight: bold;
    }
    .contenedor-materias {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }
    .final-info {
      margin-top: 3rem;
    }
  </style>
</head>
<body>
  <h1>Pensum Economía - UMNG</h1>
  <div id="contenedor" class="contenedor-materias"></div>
  <script>
    const materias = [
      {
        semestre: 1,
        materias: [
          { nombre: "Economía I", requisitos: [] },
          { nombre: "Historia Económica", requisitos: [] },
          { nombre: "Matemáticas I", requisitos: [] },
          { nombre: "Contabilidad", requisitos: [] }
        ]
      },
      {
        semestre: 2,
        materias: [
          { nombre: "Economía II", requisitos: ["Economía I"] },
          { nombre: "Microeconomía I", requisitos: ["Economía I"] },
          { nombre: "Matemáticas II", requisitos: ["Matemáticas I"] },
          { nombre: "Estadística I", requisitos: [] }
        ]
      },
      {
        semestre: 3,
        materias: [
          { nombre: "Macroeconomía I", requisitos: ["Economía II"] },
          { nombre: "Microeconomía II", requisitos: ["Microeconomía I"] },
          { nombre: "Matemáticas III", requisitos: ["Matemáticas II"] },
          { nombre: "Estadística II", requisitos: ["Estadística I"] }
        ]
      }
    ];

    const contenedor = document.getElementById('contenedor');
    let estado = JSON.parse(localStorage.getItem('estadoMaterias')) || {};

    function inicializarMateria(nombre) {
      if (!estado[nombre]) {
        estado[nombre] = { aprobado: false, intentos: [] };
      }
      if (!estado[nombre].intentos) {
        estado[nombre].intentos = [];
      }
    }

    function guardarEstado() {
      localStorage.setItem('estadoMaterias', JSON.stringify(estado));
    }

    function calcularDefinitiva(notas) {
      const n1 = parseFloat(notas.n1) || 0;
      const n2 = parseFloat(notas.n2) || 0;
      const n3 = parseFloat(notas.n3) || 0;
      return (n1 * 0.3 + n2 * 0.3 + n3 * 0.4).toFixed(2);
    }

    function mostrarMaterias() {
      contenedor.innerHTML = '';
      materias.forEach((semestreData) => {
        const div = document.createElement('div');
        div.className = `semestre semestre-${semestreData.semestre}`;
        const h2 = document.createElement('h2');
        h2.innerHTML = `<strong>Semestre ${semestreData.semestre}</strong>`;
        div.appendChild(h2);

        semestreData.materias.forEach(materia => {
          inicializarMateria(materia.nombre);

          const divMateria = document.createElement('div');
          divMateria.className = 'materia';
          if (estado[materia.nombre].aprobado) divMateria.classList.add('aprobada');

          const bloqueada = materia.requisitos.some(req => !estado[req]?.aprobado);
          if (bloqueada) divMateria.classList.add('bloqueada');

          divMateria.textContent = materia.nombre;
          divMateria.addEventListener('click', () => {
            inicializarMateria(materia.nombre);
            estado[materia.nombre].aprobado = !estado[materia.nombre].aprobado;
            guardarEstado();
            mostrarMaterias();
            mostrarCamposExtras();
          });
          div.appendChild(divMateria);
        });
        contenedor.appendChild(div);
      });
    }

    function mostrarCamposExtras() {
      let contenedorExtra = document.querySelector('.final-info');
      if (!contenedorExtra) {
        contenedorExtra = document.createElement('div');
        contenedorExtra.className = 'final-info';
        document.body.appendChild(contenedorExtra);
      }
      contenedorExtra.innerHTML = '<h2>Información adicional de materias aprobadas</h2>';

      Object.keys(estado).forEach(nombre => {
        const datos = estado[nombre];
        if (!datos.aprobado) return;
        inicializarMateria(nombre);

        const div = document.createElement('div');
        div.className = 'campos-extra';
        div.innerHTML = `<strong>${nombre}</strong>`;

        datos.intentos.forEach((intento, index) => {
          const intentoDiv = document.createElement('div');
          intentoDiv.className = 'intento';
          intentoDiv.innerHTML = `
            <label>Intento ${index + 1} - Profesor: ${intento.profesor || ''}</label><br>
            Nota 1 (30%): ${intento.n1 || ''}<br>
            Nota 2 (30%): ${intento.n2 || ''}<br>
            Nota 3 (40%): ${intento.n3 || ''}<br>
            <span class="definitiva">Definitiva: ${calcularDefinitiva(intento)}</span>
            <hr>
          `;
          div.appendChild(intentoDiv);
        });

        const nuevo = document.createElement('div');
        nuevo.innerHTML = `
          <label>Nuevo intento:</label><br>
          Profesor: <input type="text" name="prof"><br>
          Nota 1: <input type="number" step="0.01" name="n1"><br>
          Nota 2: <input type="number" step="0.01" name="n2"><br>
          Nota 3: <input type="number" step="0.01" name="n3"><br>
          <button>Guardar intento</button>
        `;
        nuevo.querySelector('button').onclick = () => {
          const intento = {
            profesor: nuevo.querySelector('input[name="prof"]').value,
            n1: nuevo.querySelector('input[name="n1"]').value,
            n2: nuevo.querySelector('input[name="n2"]').value,
            n3: nuevo.querySelector('input[name="n3"]').value
          };
          estado[nombre].intentos.push(intento);
          guardarEstado();
          mostrarCamposExtras();
        };
        div.appendChild(nuevo);
        contenedorExtra.appendChild(div);
      });
    }

    mostrarMaterias();
    mostrarCamposExtras();
  </script>
</body>
</html>
